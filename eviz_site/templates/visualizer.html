<!DOCTYPE html>
<html>

<head>
    <title>EVIZ Visualizer</title>
    
    <script src="https://unpkg.com/htmx.org@1.9.12"></script> <!-- HTMX -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js" charset="utf-8"></script> <!-- Plotly -->

    <script src="https://cdn.anychart.com/releases/8.12.1/js/anychart-core.min.js"></script> <!-- Anychart Core -->
    <script src="https://cdn.anychart.com/releases/8.12.1/js/anychart-sankey.min.js"></script> <!-- Anychart Sankey -->

    <link rel="stylesheet" href='../static/js/sankey-js/SanKEY_styles.css'> <!-- SanKEY css -->

    <script src="../static/js/d3-sankey/d3-sankey-diagram.min.js" charset="utf-8"></script> <!-- D3 Sankey -->

    <link rel="stylesheet" href="../static/css/toolbar.css" type="text/css" />
    <link rel="stylesheet" href="../static/css/visualizer.css" type="text/css" />
    <script src="../static/js/visualizer.js"></script>
    <script type="module" src="../static/js/plotUtil.js"></script> <!-- type is module because we import SanKEY code -->
</head>


<body onload="initialize(); refreshHistory();" class="gradient">



    <!-- toolbar -->
    <div class="topbar">
        <div class="left">
            <a class="main" href="{% url 'home' %}">EVIZ</a>
        </div>
        <div class="right">
            {% if request.user.is_authenticated %}
                <p style="color: #33ebed;">{{ request.user.username }}</p>
            {% endif %}
            <!-- <a class="links" href="{% url 'visualizer' %}">Visualizer</a> -->
            <a class="links" href="{% url 'about' %}">About</a>
            {% if request.user.is_authenticated %}
            <a class="links" href="{% url 'logout' %}">Sign Out</a>
            {% else %}
            <a class="links" href="{% url 'login' %}">Sign In</a>
            {% endif %}
        </div>
    </div>
    <svg viewBox="0 0 500 10" preserveAspectRatio="xMinYMin meet">
        <path d="M 0 0 C 113 16 352 -8 500 5 L 500 0 L 0 0 Z" style="stroke: none; fill:#393E46;"></path>
    </svg>
    <!-- toolbar end -->

    <div  id="history-section" class="sidebar">
        <h2>History</h2>
        <div id="history-list"></div>
    </div>
 {% comment %} <div class="sidebars">
        <h3>Advanced Graph Options</h3>
        <div class="option">
            <label for="color-by">Color by:</label>
            <select name="color_by" id="color-by">
                <option value="country">Country</option>
                <option value="energy_type">Energy Type</option>
                <option value="includes_neu">Includes NEU</option>
                <option value="last_stage">Last Stage</option>
            </select>
        </div>
        <div>
            <label for="color-scheme">Color Scheme:</label>
            <select id="color-scheme" name="color_scheme">
                <option value="Green">Green</option>
                <option value="Red">Red</option>
                <option value="Yellow">Yellow</option>
                <option value="Blue">Blue</option>
            </select>
        </div>
    
        <div class="option">
            <label for="line-style">Line Style:</label>
            <select name="line_style" id="line-style">
                <option value="solid">Solid</option>
                <option value="dash">Dashed</option>
                <option value="dot">Dotted</option>
            </select>
        </div>
        
    </div> {% endcomment %}
    <!-- main form -->
    <form method="post" action="/data" id="query-form">
        {% csrf_token %}
        <div class="query-choice">
            <div class="column info-text">
                <span class="popup-icon">&#9432;
                    <span class="popup-text">
                        Select the type of plot you want to display. <a href="{% url 'data-info'%}">Read more.</a>
                    </span>
                </span>
                Visualization
            </div>
            <div class="input-column">
                <label>
                    <input name="plot_type" type="radio" value="sankey" class="space-input" id="plot-type-input" checked>
                    Sankey
                </label><br>
                <label>
                    <input name="plot_type" type="radio" value="xy_plot" class="space-input" id="plot-type-input">
                    X-Y plot
                </label><br>
                <label>
                    <input name="plot_type" type="radio" value="matrices" class="space-input" id="plot-type-input">
                    PSUT matrices
                </label><br>
            </div>
            &#x2800
        </div>
        

        <div class="query-choice">
            <div class="info-text">
                From dataset
            </div>
            <div class="input-column">
                {% for dataset in datasets %}
                    {%if iea%}
                        {%if dataset == 'CLPFUv2.0a2'%}
                        <label><input type='radio' value="{{ dataset }}" name="dataset" class="space-input" checked>{{dataset}}</label><br>
                        {%else%}
                        <label><input type="radio" value="{{ dataset }}" name="dataset" class="space-input" required>{{ dataset }}</label><br>
                        {% endif %}
                    {%else%}
                        {%if dataset != "IEAEWEB2022"%}
                            {%if dataset == 'CLPFUv2.0a2'%}
                            <label><input type='radio' value="{{ dataset }}" name="dataset" class="space-input" checked>{{dataset}}</label><br>
                            {%else%}
                            <label><input type="radio" value="{{ dataset }}" name="dataset" class="space-input" required>{{ dataset }}</label><br>
                            {% endif %}
                        {%endif%}
                    {%endif%}
                {% endfor %}
            </div>
            &#x2800
        </div>
        <div class="query-choice">
            <div class="info-text">
                Country(ies)
            </div>
            <div class="input-column">
                <select name="country" id="country-dropdown" class="styled-dropdown space-input" required>
                {% for country in countries %}
                    {% if country == 'Ghana' %}
                        <option value="{{ country }}" selected>{{ country }}</option>
                    {% else %}
                        <option value="{{ country }}">{{ country }}</option>
                    {% endif %}
                {% endfor %}
                </select>
                <button class="add-dropdown-button" onclick="showDropdown('country')" type="button">Add Country</button>
            </div>
            &#x2800
        </div>
        <div class="query-choice">
            <div class="info-text">
                Method
            </div>
            <div class="input-column">
                <label><input type="checkbox" value="PCM" class="space-input" name="method" checked>PCM</label><br>
            </div>
            &#x2800
        </div>
        <div class="query-choice">
            <div class="info-text">
                Energy type
            </div>
            <div class="input-column">
                {% for energy_type in energy_types %}
                {% if energy_type == 'Energy' %}
                    <label><input type="checkbox" value="{{ energy_type }}" class="space-input" name="energy_type" checked>{{ energy_type }}</label><br>
                {% else %}
                    <label><input type="checkbox" value="{{ energy_type }}" class="space-input" name="energy_type">{{ energy_type }}</label><br>
                {%endif%}
                {% endfor %}
            </div>
            &#x2800
        </div>
        <div class="query-choice">
            <div class="info-text">
                Last stage
            </div>
            <div class="input-column">
                <div name="last_stage">
                    <label><input type="radio" value="Final" name="last_stage" checked class="space-input">Final</label><br>
                    <label><input type="radio" value="Useful" name="last_stage" class="space-input">Useful</label><br>
                </div>
            </div>
            &#x2800
        </div>
        <div class="query-choice">
            <div class="info-text">
                IEA and/or MW
            </div>
            <div class="input-column">
                {% for ieamw in ieamws %}
                    {%if ieamw == 'IEA'%}
                        <label><input type="checkbox" value="{{ ieamw }}" name="ieamw" checked class="space-input">{{ ieamw }}</label><br>
                    {%else%}
                        <label><input type="checkbox" value="{{ ieamw }}" name="ieamw" class="space-input">{{ ieamw }}</label><br>
                    {%endif%}
                {% endfor %}
            </div>
            &#x2800
        </div>
        <div class="query-choice">
            <div class="info-text">
                Include NEU
            </div>
            <div class="input-column">
                <input type="checkbox" value="true" name="including_neu" class="space-input" checked>
            </div>
            &#x2800
        </div>

        <!-- metadata specifics inputs -->

        <!-- efficiency dropdown -->
        <div class="query-choice">
            <div class="info-text">
                Efficiency
            </div>
            <div class="input-column">
                <select name="efficiency" class="styled-dropdown space-input" id="efficiency-dropdown">
                    <!-- TODO: don't hardcode these -->
                    <option value="EXp">EXp</option>
                    <option value="EXf">EXf</option>
                    <option value="EXu">EXu</option>
                    <option value="etapf">etapf</option>
                    <option value="etafu">etafu</option>
                    <option value="etapu">etapu</option>
                </select>
            </div>
            &#x2800
        </div>
        <!-- efficiency dropdown end -->

        <!-- single year input -->
        <div class="query-choice">
            <div class="info-text">
                Year
            </div>
            <div class="input-column">
                <input name="year" class="styled-dropdown space-input" id="single-year-input" value="1971">
            </div>
            &#x2800
        </div>
        <!-- single year input -->

        <!-- year range input -->
        <div class="query-choice">
            <div class="info-text">
                From year
            </div>
            <div class="input-column">
                <input name="year" class="styled-dropdown space-input" id="from-year-input" value="1971">
            </div>
            <div class="info-text">
                to year
            </div>
            <div class="input-column">
                <input name="to_year" class="styled-dropdown space-input" id="to-year-input"value="2020">
            </div>
            &#x2800
        </div>
        <!-- year range input end-->

        <!-- matrix dropdown -->
        <div class="query-choice">
            <div class="info-text">
                Matrix
            </div>
            <div class="input-column">
                <select name="matname" id="matname-dropdown" class="styled-dropdown space-input" class="space-input" >
                    <option value="RUVY" selected >RUVY</option>
                    {% for matname in matnames %}
                    <option value="{{ matname }}">{{ matname }}</option>
                    {% endfor %}
                </select>
            </div>
            &#x2800
        </div>
        <!-- matrix dropdown end -->
        
        <!-- metadata specifics inputs end -->


        <div class="button-container">
            <button hx-post="/plot" hx-swap="innerHTML" hx-target="#plot-section" hx-indicator="#plot-spinner" type="button"
                id="get" class="main-button" onclick='document.getElementById("plot-section").scrollIntoView(); refreshHistory();'>
                <!-- onclick for bringing user to plot area -->
                Make Plot
            </button>
            <button type="submit" id="download" class="main-button"
                onclick="return confirm('By accepting you confirm that you understand IEA data is proprietary and cannot be shared with those not authorized to see it.')">
                <!-- onclick for bringing user to plot area -->
                Download Data
            </button>
        </div>
    </form>
    <!-- main form end -->



    <!-- plotting area -->
    <div id="plot-with-extra">
        <div id="plot-section">
            <!-- This will be replaced with the plot from HTMX -->
        </div>
        <div id="spinner-container"><span id="plot-spinner" class="loader htmx-indicator"></span></div>
        <button id="compare-btn">Compare</button>
    </div>
    <!-- plotting area end -->

</body>

</html>
